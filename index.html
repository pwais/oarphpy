

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart &mdash; oarphpy 0.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> oarphpy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Quickstart</a></li>
<li><a class="reference internal" href="#demos">Demos</a></li>
<li><a class="reference internal" href="#dockerized-development-environments">Dockerized Development Environments</a></li>
<li><a class="reference internal" href="#development">Development</a><ul>
<li><a class="reference internal" href="#oarphpy-api-documentation">OarphPy API Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-oarphpy.spark"><cite>oarphpy.spark</cite></a><ul>
<li><a class="reference internal" href="#oarphpy.spark.for_each_executor"><code class="docutils literal notranslate"><span class="pre">for_each_executor()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.cluster_cpu_count"><code class="docutils literal notranslate"><span class="pre">cluster_cpu_count()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.union_dfs"><code class="docutils literal notranslate"><span class="pre">union_dfs()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.get_balanced_sample"><code class="docutils literal notranslate"><span class="pre">get_balanced_sample()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.cluster_get_info"><code class="docutils literal notranslate"><span class="pre">cluster_get_info()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.test_pi"><code class="docutils literal notranslate"><span class="pre">test_pi()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.test_egg"><code class="docutils literal notranslate"><span class="pre">test_egg()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.test_tensorflow"><code class="docutils literal notranslate"><span class="pre">test_tensorflow()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.CounterAccumulator"><code class="docutils literal notranslate"><span class="pre">CounterAccumulator</span></code></a><ul>
<li><a class="reference internal" href="#oarphpy.spark.CounterAccumulator.zero"><code class="docutils literal notranslate"><span class="pre">CounterAccumulator.zero()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.CounterAccumulator.addInPlace"><code class="docutils literal notranslate"><span class="pre">CounterAccumulator.addInPlace()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#oarphpy.spark.SessionFactory"><code class="docutils literal notranslate"><span class="pre">SessionFactory</span></code></a><ul>
<li><a class="reference internal" href="#oarphpy.spark.SessionFactory.create_egg"><code class="docutils literal notranslate"><span class="pre">SessionFactory.create_egg()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.SessionFactory.getOrCreate"><code class="docutils literal notranslate"><span class="pre">SessionFactory.getOrCreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#oarphpy.spark.LocalK8SSpark"><code class="docutils literal notranslate"><span class="pre">LocalK8SSpark</span></code></a><ul>
<li><a class="reference internal" href="#oarphpy.spark.LocalK8SSpark.getOrCreate"><code class="docutils literal notranslate"><span class="pre">LocalK8SSpark.getOrCreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#oarphpy.spark.NBSpark"><code class="docutils literal notranslate"><span class="pre">NBSpark</span></code></a><ul>
<li><a class="reference internal" href="#oarphpy.spark.NBSpark.getOrCreate"><code class="docutils literal notranslate"><span class="pre">NBSpark.getOrCreate()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#oarphpy.spark.Tensor"><code class="docutils literal notranslate"><span class="pre">Tensor</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.CloudpickeledCallable"><code class="docutils literal notranslate"><span class="pre">CloudpickeledCallable</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.RowAdapter"><code class="docutils literal notranslate"><span class="pre">RowAdapter</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.spark.spark_df_to_tf_dataset"><code class="docutils literal notranslate"><span class="pre">spark_df_to_tf_dataset()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-oarphpy.plotting"><cite>oarphpy.plotting</cite></a><ul>
<li><a class="reference internal" href="#oarphpy.plotting.hash_to_rbg"><code class="docutils literal notranslate"><span class="pre">hash_to_rbg()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.plotting.img_to_data_uri"><code class="docutils literal notranslate"><span class="pre">img_to_data_uri()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.plotting.df_histogram"><code class="docutils literal notranslate"><span class="pre">df_histogram()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.plotting.HistogramWithExamplesPlotter"><code class="docutils literal notranslate"><span class="pre">HistogramWithExamplesPlotter</span></code></a><ul>
<li><a class="reference internal" href="#oarphpy.plotting.HistogramWithExamplesPlotter.run"><code class="docutils literal notranslate"><span class="pre">HistogramWithExamplesPlotter.run()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-oarphpy.util.thruput_observer"><cite>oarphpy.util.thruput_observer</cite></a><ul>
<li><a class="reference internal" href="#oarphpy.util.thruput_observer.ThruputObserver"><code class="docutils literal notranslate"><span class="pre">ThruputObserver</span></code></a><ul>
<li><a class="reference internal" href="#oarphpy.util.thruput_observer.ThruputObserver.observe"><code class="docutils literal notranslate"><span class="pre">ThruputObserver.observe()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.thruput_observer.ThruputObserver.union"><code class="docutils literal notranslate"><span class="pre">ThruputObserver.union()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.thruput_observer.ThruputObserver.monitoring_tensor"><code class="docutils literal notranslate"><span class="pre">ThruputObserver.monitoring_tensor()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.thruput_observer.ThruputObserver.wrap_func"><code class="docutils literal notranslate"><span class="pre">ThruputObserver.wrap_func()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#module-oarphpy.util.tfutil"><cite>oarphpy.util.tfutil</cite></a><ul>
<li><a class="reference internal" href="#oarphpy.util.tfutil.give_me_frozen_graph"><code class="docutils literal notranslate"><span class="pre">give_me_frozen_graph()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.tfutil.tf_variable_summaries"><code class="docutils literal notranslate"><span class="pre">tf_variable_summaries()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.tfutil.TFRecordsFileAsListOfStrings"><code class="docutils literal notranslate"><span class="pre">TFRecordsFileAsListOfStrings</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-oarphpy.util.misc"><cite>oarphpy.util.misc</cite></a><ul>
<li><a class="reference internal" href="#oarphpy.util.misc.get_size_of_deep"><code class="docutils literal notranslate"><span class="pre">get_size_of_deep()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.stable_hash"><code class="docutils literal notranslate"><span class="pre">stable_hash()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.ichunked"><code class="docutils literal notranslate"><span class="pre">ichunked()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.roundrobin"><code class="docutils literal notranslate"><span class="pre">roundrobin()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.as_row_of_constants"><code class="docutils literal notranslate"><span class="pre">as_row_of_constants()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.Proxy"><code class="docutils literal notranslate"><span class="pre">Proxy</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.quiet"><code class="docutils literal notranslate"><span class="pre">quiet()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.with_cwd"><code class="docutils literal notranslate"><span class="pre">with_cwd()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.to_png_bytes"><code class="docutils literal notranslate"><span class="pre">to_png_bytes()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.to_jpeg_bytes"><code class="docutils literal notranslate"><span class="pre">to_jpeg_bytes()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.get_jpeg_size"><code class="docutils literal notranslate"><span class="pre">get_jpeg_size()</span></code></a></li>
<li><a class="reference internal" href="#oarphpy.util.misc.download"><code class="docutils literal notranslate"><span class="pre">download()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#extra">Extra</a><ul>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">oarphpy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>View OarphPy <a class="reference external" href="https://github.com/pwais/oarphpy">on Github</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                   _________________________
                  &lt; OarphPy!! Oarph! Oarph! &gt;
                  &lt;   OarphKit for Python!! &gt;
                   -------------------------
                                 \
                                  \
  ____                __   ___       -~~~~-
 / __ \___ ________  / /  / _ \__ __|O __ O|
/ /_/ / _ `/ __/ _ \/ _ \/ ___/ // /|_\__/_|__-
\____/\_,_/_/ / .__/_//_/_/   \_,---(__/\__)---
          .--/_/             /___/ /  ~--~
     ,__;`  o __`&#39;.          _,..-/  | \/ |
     &#39;  `&#39;---&#39;  `&#39;.&#39;.      .&#39;.&#39;` |   | /\ |   |
                   .&#39;-...-`.&#39;  _/ /\__    __/\ \_
                     -...-`  ~~~~~    ~~~~    ~~~~~
</pre></div>
</div>
<a class="reference external image-reference" href="http://www.apache.org/licenses/LICENSE-2.0"><img alt="License" src="http://img.shields.io/:license-apache-orange.svg" /></a>
<a class="reference external image-reference" href="https://circleci.com/gh/pwais/oarphpy/tree/master"><img alt="Build Status" src="https://circleci.com/gh/pwais/oarphpy.png?style=shield" /></a>
<a class="reference external image-reference" href="https://badge.fury.io/py/oarphpy"><img alt="PyPI version" src="https://badge.fury.io/py/oarphpy.svg" /></a>
<p>OarphPy is a collection of Python utilities for Data Science with
<a class="reference external" href="https://spark.apache.org/docs/latest/api/python/">PySpark</a> and Tensorflow.
Related (but orthogonal) to <a class="reference external" href="https://github.com/pwais/oarphkit">OarphKit</a>.</p>
<section id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this heading">¶</a></h1>
<p>Install from PyPI: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">oarphpy</span></code>.  We test OarphPy in a variet of
environments (see below), so it should play well with your Jupyter/Colab
notebook or project environment.  To include all extras, use
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">oarphpy[all]</span></code>.</p>
<p>Or use the dockerized environment hosted on <a class="reference external" href="https://hub.docker.com/u/oarphpy">DockerHub</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./oarphcli --shell
-- or --
$ docker run -it --net=host oarphpy/full bash
</pre></div>
</div>
<p>See also <a class="reference external" href="https://pwais.github.io/oarphpy/">API documentation</a>.</p>
</section>
<section id="demos">
<h1>Demos<a class="headerlink" href="#demos" title="Permalink to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="https://pwais.github.io/oarph-oarphs/2020/02/03/atrick.html">Automagically Shipping Custom Libraries in Spark Using OarphPy</a></p></li>
</ul>
</section>
<section id="dockerized-development-environments">
<h1>Dockerized Development Environments<a class="headerlink" href="#dockerized-development-environments" title="Permalink to this heading">¶</a></h1>
<p>OarphPy is built and tested in a variety of environments to ensure the
library works with and without <a class="reference external" href="setup.py#L18">optional dependencies</a>.  These
environments are shared on <a class="reference external" href="https://hub.docker.com/u/oarphpy">DockerHub</a> and
defined in the <a class="reference external" href="docker">docker</a> subdirectory of this repo:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">oarphpy/full</span></code> – Includes Tensorflow, Jupyter, a binary install of
<a class="reference external" href="https://spark.apache.org/">Spark</a>, and other tools like
<a class="reference external" href="https://bokeh.org/">Bokeh</a>. Use this environment for adhoc data science or
as a starter for other projects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oarphpy/base-py2</span></code> – Tests <code class="docutils literal notranslate"><span class="pre">oarphpy</span></code> in a vanilla Python 2.7 environment
to ensure clean interop with other projects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oarphpy/base-py3</span></code> – Tests <code class="docutils literal notranslate"><span class="pre">oarphpy</span></code> in a vanilla Python 3 environment
to ensure clean interop with other projects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oarphpy/spark</span></code> – Tests <code class="docutils literal notranslate"><span class="pre">oarphpy</span></code> with a vanilla install of
<a class="reference external" href="https://spark.apache.org/">PySpark</a> to ensure basic compatibility.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oarphpy/tensorflow</span></code> – Tests <code class="docutils literal notranslate"><span class="pre">oarphpy</span></code> with Tensorflow 1.x to ensure basic
compatibility (e.g. of <code class="docutils literal notranslate"><span class="pre">oarphpy.util.tfutil</span></code>).</p></li>
</ul>
</section>
<section id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this heading">¶</a></h1>
<p>See <code class="docutils literal notranslate"><span class="pre">./oarphcli</span> <span class="pre">--help</span></code> for the development and release workflow.</p>
<section id="oarphpy-api-documentation">
<h2>OarphPy API Documentation<a class="headerlink" href="#oarphpy-api-documentation" title="Permalink to this heading">¶</a></h2>
</section>
</section>
<section id="module-oarphpy.spark">
<span id="oarphpy-spark"></span><h1><cite>oarphpy.spark</cite><a class="headerlink" href="#module-oarphpy.spark" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.for_each_executor">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">for_each_executor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thunk</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#for_each_executor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.for_each_executor" title="Permalink to this definition">¶</a></dt>
<dd><p>While Spark does not officially provide an API since the number
of executors can change through the course of a job, this approach
leverages the best practices to evaluate <cite>thunk</cite> at most once per
executor.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.cluster_cpu_count">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">cluster_cpu_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#cluster_cpu_count"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.cluster_cpu_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <cite>os.cpu_count()</cite> but for an entire Spark cluster.  Useful for
scalling memory-intensive jobs that use the RDD api.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.union_dfs">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">union_dfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">dfs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#union_dfs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.union_dfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the union of a sequence DataFrames and attempt to merge
the schemas of each (i.e. union of all columns).
Based upon <a class="reference external" href="https://stackoverflow.com/a/40404249">https://stackoverflow.com/a/40404249</a></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.get_balanced_sample">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">get_balanced_sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_per_category</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1337</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#get_balanced_sample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.get_balanced_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a column <cite>col</cite> in <cite>spark_df</cite>, return a <em>balanced</em> sample
(countering class imbalances in <cite>spark_df[col]</cite>).  Optionally limit the
sample to having up to <cite>n_per_category</cite> examples for every distinct
categorical value of <cite>spark_df[col]</cite>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.cluster_get_info">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">cluster_get_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#cluster_get_info"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.cluster_get_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a text report showing various details about each worker in the
cluster.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.test_pi">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">test_pi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#test_pi"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.test_pi" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the “textbook” Monte Carlo Pi Sampling demo and assert correctness.
When run on a cluster, this test can help suss out networking issues
between the master and worker machines.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.test_egg">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">test_egg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">modname='oarphpy'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_egg_contents=&lt;function</span> <span class="pre">_op_test&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#test_egg"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.test_egg" title="Permalink to this definition">¶</a></dt>
<dd><p>Test the egg that <cite>SessFactory</cite> (below) dynamically builds and includes
in spark jobs.  We’ll run the function <cite>test_egg_contents</cite> on each worker
to actually execute code included in the egg.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.test_tensorflow">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">test_tensorflow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#test_tensorflow"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.test_tensorflow" title="Permalink to this definition">¶</a></dt>
<dd><p>Remotely test Tensorflow support in the given <cite>spark</cite> cluster</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.CounterAccumulator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">CounterAccumulator</span></span><a class="reference internal" href="_modules/oarphpy/spark.html#CounterAccumulator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.CounterAccumulator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="oarphpy.spark.CounterAccumulator.zero">
<span class="sig-name descname"><span class="pre">zero</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#CounterAccumulator.zero"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.CounterAccumulator.zero" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide a “zero value” for the type, compatible in dimensions with the
provided <cite>value</cite> (e.g., a zero vector)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.spark.CounterAccumulator.addInPlace">
<span class="sig-name descname"><span class="pre">addInPlace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#CounterAccumulator.addInPlace"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.CounterAccumulator.addInPlace" title="Permalink to this definition">¶</a></dt>
<dd><p>Add two values of the accumulator’s data type, returning a new value;
for efficiency, can also update <cite>value1</cite> in place and return it.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.SessionFactory">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">SessionFactory</span></span><a class="reference internal" href="_modules/oarphpy/spark.html#SessionFactory"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.SessionFactory" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is a factory for pre-configured <cite>SparkSession</cite> instances.  A
primary feaure of this factory is that it automagically includes the caller’s
python module as a Spark PyFile, thus effectively shipping the user’s python
project with the Spark job.  This class also helps centralize project-wide
Spark configuration.  This class is designed as programmatic replacement
for the <cite>spark-submit</cite> shell script.</p>
<p>To create and use a session:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">oarphpy</span> <span class="kn">import</span> <span class="n">spark</span> <span class="k">as</span> <span class="n">S</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">SessionFactory</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">num_executors</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Or using as a context manager:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">S</span><span class="o">.</span><span class="n">SessionFactory</span><span class="o">.</span><span class="n">sess</span><span class="p">()</span> <span class="k">as</span> <span class="n">spark</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">num_executors</span><span class="p">(</span><span class="n">spark</span><span class="p">))</span>
<span class="go">1</span>
</pre></div>
</div>
<p>See <cite>LocalK8SSpark</cite> below for an example of how to subclass this factory for
your own project.  See also <cite>NBSpark</cite> below for an example subclass
that enables interop with the <cite>sparkmonitor</cite> package for jupyter.</p>
<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.spark.SessionFactory.create_egg">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">create_egg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force_new</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#SessionFactory.create_egg"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.SessionFactory.create_egg" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Python Egg from the current project and return a path
to the artifact.  The path may be to a cached, pre-computed egg only
if not <cite>force_new</cite>.  The ‘current project’ is either class-defaulted or
auto-deduced.</p>
<p>Why an Egg?  <cite>pyspark</cite> supports zipfiles and egg files as Python artifacts.
One might wish to use a wheel instead of an egg.  See this excellent
article and repo:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://bytes.grubhub.com/managing-dependencies-and-artifacts-in-pyspark-7641aa89ddb7">https://bytes.grubhub.com/managing-dependencies-and-artifacts-in-pyspark-7641aa89ddb7</a></p></li>
<li><p><a class="reference external" href="https://github.com/alekseyig/spark-submit-deps">https://github.com/alekseyig/spark-submit-deps</a></p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>The drawbacks to using a wheel include:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>wheels often require native libraries to be installed (e.g. via</dt><dd><p><cite>apt-get</cite>), and those deps are typically best baked into the Spark
Worker environment (versus installed every job run).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The <cite>BdistSpark</cite> example above is actually rather slow, especially</dt><dd><p>when Tensorflow is a dependency, and <cite>BdistSpark</cite> must run before
every job is submitted.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Spark treats wheels as zip files and unzips them on every run; this</dt><dd><p>unzip operation can be very expensive if the zipfile contains large
binaries (e.g. tensorflow)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Wheels are not yet officially supported:</dt><dd><p><a class="reference external" href="https://issues.apache.org/jira/browse/SPARK-6764">https://issues.apache.org/jira/browse/SPARK-6764</a></p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>In comparison, an Egg provides the main benefits we want (to ship project
code, often pre-committed code, to workers).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.spark.SessionFactory.getOrCreate">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getOrCreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#SessionFactory.getOrCreate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.SessionFactory.getOrCreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Spark sessions are typically instantiated using the
<cite>Builder.getOrCreate()</cite> or <cite>SparkSession.getOrCreate()</cite> methods.  This
method is a drop-in replacement that uses class-specified defaults,
includes the local python module as a PyFile, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A <cite>pyspark.sql.session.SparkSession</cite> instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.LocalK8SSpark">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">LocalK8SSpark</span></span><a class="reference internal" href="_modules/oarphpy/spark.html#LocalK8SSpark"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.LocalK8SSpark" title="Permalink to this definition">¶</a></dt>
<dd><p>Example of how to subclass the Spark factory above for use with K8S</p>
<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.spark.LocalK8SSpark.getOrCreate">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getOrCreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#LocalK8SSpark.getOrCreate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.LocalK8SSpark.getOrCreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Spark sessions are typically instantiated using the
<cite>Builder.getOrCreate()</cite> or <cite>SparkSession.getOrCreate()</cite> methods.  This
method is a drop-in replacement that uses class-specified defaults,
includes the local python module as a PyFile, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A <cite>pyspark.sql.session.SparkSession</cite> instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.NBSpark">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">NBSpark</span></span><a class="reference internal" href="_modules/oarphpy/spark.html#NBSpark"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.NBSpark" title="Permalink to this definition">¶</a></dt>
<dd><p>NBSpark is a session builder for local Jupyter notebooks.  Also includes
support for the <cite>sparkmonitor</cite> jupyter package, see
<a class="reference external" href="https://krishnan-r.github.io/sparkmonitor/">https://krishnan-r.github.io/sparkmonitor/</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.spark.NBSpark.getOrCreate">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">getOrCreate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#NBSpark.getOrCreate"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.NBSpark.getOrCreate" title="Permalink to this definition">¶</a></dt>
<dd><p>Spark sessions are typically instantiated using the
<cite>Builder.getOrCreate()</cite> or <cite>SparkSession.getOrCreate()</cite> methods.  This
method is a drop-in replacement that uses class-specified defaults,
includes the local python module as a PyFile, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A <cite>pyspark.sql.session.SparkSession</cite> instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.Tensor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">Tensor</span></span><a class="reference internal" href="_modules/oarphpy/spark.html#Tensor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.Tensor" title="Permalink to this definition">¶</a></dt>
<dd><p>An ndarray-like object designed to store numpy arrays in Parquet /
Spark SQL format.  Spark’s DenseVector and Matrix unfortunately don’t
support arbitrary tensor shape.  Furthermore, <cite>Tensor</cite> stores data in
an explicit order accessible to external readers such as Eigen in C++
or nd4j / BLAS wrappers in Java.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.CloudpickeledCallable">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">CloudpickeledCallable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#CloudpickeledCallable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.CloudpickeledCallable" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps callable objects (e.g. functions, including lambdas) and
uses <cite>cloudpickle</cite> for serialization.  Spark uses <cite>cloudpickle</cite> for
serializing _tasks_ (e.g. map functions) but uses <cite>pickle</cite> for
serializing _data_.  In particular, data in a Spark RDD or DataFrame
must be pickleable.  <cite>CloudpickeledCallable</cite> provides a wrapper
so that you can embed Python functions as <em>data</em> in RDDs, DataFrames,
and other forms of data at rest (e.g. pickle files or Parquet data).</p>
<p>Note that <cite>cloudpickle</cite> can be selective about how much of the object tree
that it serializes; some imports and globals may get ignored.  When you
deserialize and invoke a <cite>CloudpickeledCallable</cite>, your interpreter should
have the same (or similar) code as that used when serializing the callable,
otherwise behavior may be difficult to predict.</p>
<p>Note that <cite>cloudpickle</cite> can’t handle non-serializable data like thread local
variables, mutices, etc.  <cite>CloudpickeledCallable</cite> won’t work for all code.</p>
<p><cite>CloudpickeledCallable</cite> is useful for embedding flyweights in your dataset.
(FMI see &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Flyweight_pattern">https://en.wikipedia.org/wiki/Flyweight_pattern</a>&gt; )
For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">load_matrix</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_db_row</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;path/to/data.txt&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="s1">&#39;factory&#39;</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">CloudpickeledCallable</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">load_matrix</span><span class="p">(</span><span class="s1">&#39;path/to/data.txt&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">my_db_row</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dumped.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Now if you deserialize <cite>my_db_row</cite> from disk and run <cite>my_db_row[‘factory’]()</cite>,
your <cite>load_matrix()</cite> helper will get invoked with the embedded path.  Thus
your <cite>my_db_row</cite> is a flyweight for the data in ‘path/to/data.txt’.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.spark.RowAdapter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">RowAdapter</span></span><a class="reference internal" href="_modules/oarphpy/spark.html#RowAdapter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.RowAdapter" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms between custom objects and <a href="#id3"><span class="problematic" id="id4">`</span></a>pyspark.sql.Row`s used in Spark SQL
or Parquet files. Use to encode numpy arrays and standard Python objects
with a transparent Parquet schema that is accessible to other readers.</p>
<dl class="simple">
<dt>Usage:</dt><dd><ul class="simple">
<li><p>Use <cite>RowAdapter.to_row()</cite> in place of the <cite>pyspark.sql.Row</cite> constructor.</p></li>
<li><dl class="simple">
<dt>Call <cite>RowAdapter.from_row()</cite> on any <cite>pyspark.sql.Row</cite> instance, e.g.</dt><dd><p>within an <cite>RDD.map()</cite> call or after a <cite>DataFrame.collect()</cite> call.</p>
</dd>
</dl>
</li>
<li><p>Decoding requires Python objects to have an available zero-arg __init__()</p></li>
</ul>
</dd>
</dl>
<p>Unfortunately, we can’t use Spark’s UDT API to embed this adapter (and
obviate user calls) because UDTs require schema definitions.  Furthermore,
Spark &lt;=2.x could not handle UDTs nested in maps or lists; i.e.
[UDT()] (i.e. a list of UDTs) and {‘foo’: UDT()} (i.e. a map with UDT values)
would cause Spark to crash.  Moreover, for ndarray data, Spark’s ml.linalg
package coerces all data to floats.</p>
<dl class="simple">
<dt>Benefits of RowAdapter:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Transparently handles numpy arrays and numpy boxed scalar types</dt><dd><p>(e.g. np.float32).</p>
</dd>
</dl>
</li>
<li><p>Deep type adaptation; supports nested types.</p></li>
<li><dl class="simple">
<dt>At the decode stage, supports evolution of object types independent of</dt><dd><dl class="simple">
<dt>the schema of data at rest:</dt><dd><ul>
<li><p>Added object fields don’t get set unless there’s a recorded value</p></li>
<li><p>Removed object fields will get ignored</p></li>
<li><dl class="simple">
<dt>NB: Fields that change type will get set with the data at rest;</dt><dd><p>if you need to change type, consider adding a new field.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Handles slotted Python objects (which Spark currently does not support),</dt><dd><p>as well as un-slotted objects (where Spark supports automatic encoding
but not decoding).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Enables saving objects and numpy arrays to Parquet in a format accessible</dt><dd><p>to external systems (no additional SERDES library required)</p>
</dd>
</dl>
</li>
<li><p>Uses cloudpickle to serialize <cite>CloudpickeledCallable</cite>-wrapped functions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.spark.spark_df_to_tf_dataset">
<span class="sig-prename descclassname"><span class="pre">oarphpy.spark.</span></span><span class="sig-name descname"><span class="pre">spark_df_to_tf_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shard_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spark_row_to_tf_element</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tf_element_types</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tf_output_shapes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_deterministic_element_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_reader_threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logging_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'spark_tf_dataset'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/spark.html#spark_df_to_tf_dataset"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.spark.spark_df_to_tf_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a tf.data.Dataset that reads from the Spark Dataframe
<cite>spark_df</cite>.  Executes parallel reads using the Tensorflow’s internal
(native code) threadpool.  Each thread reads a single Spark partition
at a time.</p>
<p>This utility is similar to Petastorm’s <cite>make_reader()</cite> but is far simpler
and leverages Tensorflow’s build-in threadpool (so we let Tensorflow
do the read scheduling).  Status: alpha-quality; some perf quirks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spark_df</strong> (<em>pyspark.sql.DataFrame</em>) – Read from this Dataframe.</p></li>
<li><p><strong>shard_col</strong> (<em>str</em>) – Implicly shard the dataset using this column; read
one shard per reader thread at a time to conserve memory.</p></li>
<li><p><strong>spark_row_to_tf_element</strong> (<em>func</em>) – Use this function to map each pyspark.sql.Row in <cite>spark_df</cite>
to a tuple that represents a single element of the
induced TF Dataset.</p></li>
<li><p><strong>tf_element_types</strong> (<em>tuple</em>) – The types of the elements that <cite>spark_row_to_tf_element</cite> returns;
e.g. (tf.float32, tf.string).</p></li>
<li><p><strong>tf_output_shapes</strong> (<em>tuple</em>) – Optionally specify the shape of the output of <cite>spark_row_to_tf_element</cite>;
e.g. (tf.TensorShape([]), tf.TensorShape([None])) (where the former
return element is a single scalar and the latter is a list)</p></li>
<li><p><strong>non_deterministic_element_order</strong> (<em>bool</em>) – Allow the resulting tf.data.Dataset to have elements in
non-deterministic order for speed gains.</p></li>
<li><p><strong>num_reader_threads</strong> (<em>int</em>) – Tell Tensorflow to use this many reader threads, or use -1
to provision one reader thread per CPU core.</p></li>
<li><p><strong>logging_name</strong> (<em>str</em>) – Log progress under this name.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>The induced TF Datset with one element per</dt><dd><p>row in <cite>spark_df</cite>.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tf.data.Dataset</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-oarphpy.plotting">
<span id="oarphpy-plotting"></span><h1><cite>oarphpy.plotting</cite><a class="headerlink" href="#module-oarphpy.plotting" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.plotting.hash_to_rbg">
<span class="sig-prename descclassname"><span class="pre">oarphpy.plotting.</span></span><span class="sig-name descname"><span class="pre">hash_to_rbg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/plotting.html#hash_to_rbg"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.plotting.hash_to_rbg" title="Permalink to this definition">¶</a></dt>
<dd><p>Given some value <cite>x</cite> (integral types work best), hash <cite>x</cite>
to an <cite>(r, g, b)</cite> color tuple using a hue based on the hash
and the given <cite>s</cite> (saturation) and <cite>v</cite> (lightness).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.plotting.img_to_data_uri">
<span class="sig-prename descclassname"><span class="pre">oarphpy.plotting.</span></span><span class="sig-name descname"><span class="pre">img_to_data_uri</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'jpg'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jpeg_quality</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">75</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/plotting.html#img_to_data_uri"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.plotting.img_to_data_uri" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a numpy array <cite>img</cite>, return a <cite>data:</cite> URI suitable for use in
an HTML image tag.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.plotting.df_histogram">
<span class="sig-prename descclassname"><span class="pre">oarphpy.plotting.</span></span><span class="sig-name descname"><span class="pre">df_histogram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spark_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bins</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/plotting.html#df_histogram"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.plotting.df_histogram" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute and return a histogram of <cite>bins</cite> of the values in the column
named <cite>col</cite> in spark Dataframe <cite>spark_df</cite>.  Return type is designed
to match <cite>numpy.histogram()</cite>.</p>
<p>NB: if your <cite>col</cite> has only NaNs or NULLs, then pyspark’s RDD::histogram()
call below might fail and claim the RDD is empty.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.plotting.HistogramWithExamplesPlotter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.plotting.</span></span><span class="sig-name descname"><span class="pre">HistogramWithExamplesPlotter</span></span><a class="reference internal" href="_modules/oarphpy/plotting.html#HistogramWithExamplesPlotter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.plotting.HistogramWithExamplesPlotter" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and return a Bokeh plot depicting a histogram of a single column in
a Spark DataFrame.  Clicking on a bar in the histogram will interactively
show examples from that bucket.</p>
<p><cite>SUB_PIVOT_COL</cite> - Optionally choose an additional dimension of the data and
include histograms of the data pivoted by that dimension. For example, if we
are histogramming the “height” dimension over a population, and we set
<cite>SUB_PIVOT_COL</cite> to the “gender” column, then we’ll get a histogram of height
over ALL genders as well as height histograms for each distinct value in the
“gender” column.</p>
<p>The user can override how examples are displayed; subclasses can override
<cite>HistogramWithExamplesPlotter::display_bucket()</cite></p>
<p>See <cite>HistogramWithExamplesPlotter::run()</cite>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.plotting.HistogramWithExamplesPlotter.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/plotting.html#HistogramWithExamplesPlotter.run"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.plotting.HistogramWithExamplesPlotter.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute histograms and return the final plot.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pyspark.sql.DataFrame</em>) – Read from this DataFrame.  The caller may
want to <cite>cache()</cite> the DataFrame as this routine will do a variety of
random reads and aggregations on the data.</p></li>
<li><p><strong>col</strong> (<em>str</em>) – The x-axis for the computed histogram shall this this column
in <cite>df</cite> as the chosen metric.  Spark automatically ignores nulls and
nans.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>bokeh layout object with a plot.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-oarphpy.util.thruput_observer">
<span id="oarphpy-util-thruput-observer"></span><h1><cite>oarphpy.util.thruput_observer</cite><a class="headerlink" href="#module-oarphpy.util.thruput_observer" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.util.thruput_observer.ThruputObserver">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.util.thruput_observer.</span></span><span class="sig-name descname"><span class="pre">ThruputObserver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_on_del</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_stats</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_freq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_total</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_total_chunks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/thruput_observer.html#ThruputObserver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.thruput_observer.ThruputObserver" title="Permalink to this definition">¶</a></dt>
<dd><p>A utility for measuring the runtime and throughput of a subroutine.
Similar in spirit to <cite>tqdm</cite>, except <cite>ThruputObserver</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Tracks not just time but a size metric (e.g. memory) in bytes</p></li>
<li><p>Reports percentiles</p></li>
<li><p>Simply logs strings and is not terminal-interactive</p></li>
</ul>
</div></blockquote>
<p>While <cite>tqdm</cite> is useful for notebooks, <cite>ThruputObserver</cite> seeks to be more
useful for longer-running batch jobs.</p>
<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.util.thruput_observer.ThruputObserver.observe">
<span class="sig-name descname"><span class="pre">observe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bytes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/thruput_observer.html#ThruputObserver.observe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.thruput_observer.ThruputObserver.observe" title="Permalink to this definition">¶</a></dt>
<dd><p>NB: contextmanagers appear to be expensive due to object creation.
Use ThurputObserver#{start,stop}_block() for &lt;10ms ops.
FMI <a class="reference external" href="https://stackoverflow.com/questions/34872535/why-contextmanager-is-slow">https://stackoverflow.com/questions/34872535/why-contextmanager-is-slow</a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.util.thruput_observer.ThruputObserver.union">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">union</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">thruputs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/thruput_observer.html#ThruputObserver.union"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.thruput_observer.ThruputObserver.union" title="Permalink to this definition">¶</a></dt>
<dd><p>Support reduction for use in e.g. MapReduce jobs as a counter</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.util.thruput_observer.ThruputObserver.monitoring_tensor">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">monitoring_tensor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tensor</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">observer_init_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/thruput_observer.html#ThruputObserver.monitoring_tensor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.thruput_observer.ThruputObserver.monitoring_tensor" title="Permalink to this definition">¶</a></dt>
<dd><p>Monitor the size of the given tensorflow <cite>Tensor</cite> and record a
text TF Summary with the contents of this ThruputObserver.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oarphpy.util.thruput_observer.ThruputObserver.wrap_func">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">wrap_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">observer_init_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/thruput_observer.html#ThruputObserver.wrap_func"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.thruput_observer.ThruputObserver.wrap_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorate <cite>func</cite> and observe a block on each call</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-oarphpy.util.tfutil">
<span id="oarphpy-util-tfutil"></span><h1><cite>oarphpy.util.tfutil</cite><a class="headerlink" href="#module-oarphpy.util.tfutil" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.tfutil.give_me_frozen_graph">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.tfutil.</span></span><span class="sig-name descname"><span class="pre">give_me_frozen_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoint</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nodes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blacklist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_graph</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sess</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">saver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/tfutil.html#give_me_frozen_graph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.tfutil.give_me_frozen_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Tensorflow has several ways to load checkpoints / graph artifacts.
It’s impossible to know if some API is stable or if tomorrow somebody
will invent something new and break everything becaus PyTorch is shiny
(e.g. TF Eager).  Sam Abrahams wrote a book on Tensorflow
( <a class="reference external" href="https://www.amazon.com/TensorFlow-Machine-Intelligence-hands--introduction-ebook/dp/B01IZ43JV4/">https://www.amazon.com/TensorFlow-Machine-Intelligence-hands–introduction-ebook/dp/B01IZ43JV4/</a> )
and one time couldn’t tell me definitively which API to use.  What’s more is
that freeze_graph.py is an optional script instead of a library module in
Tensorflow.  Chaos!!</p>
<p>So, based upon spark-dl’s <cite>strip_and_freeze_until()</cite>
( <a class="reference external" href="https://github.com/databricks/spark-deep-learning/blob/4daa1179f498df4627310afea291133539ce7001/python/sparkdl/graph/utils.py#L199">https://github.com/databricks/spark-deep-learning/blob/4daa1179f498df4627310afea291133539ce7001/python/sparkdl/graph/utils.py#L199</a> ),
here’s a utility for getting a frozen, serializable, pyspark-friendly
graph from a checkpoint artifact metagraph thingy I have no idea.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.tfutil.tf_variable_summaries">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.tfutil.</span></span><span class="sig-name descname"><span class="pre">tf_variable_summaries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">var</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/tfutil.html#tf_variable_summaries"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.tfutil.tf_variable_summaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Create Tensorboard summaries showing basic stats of the
variable <cite>var</cite>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.util.tfutil.TFRecordsFileAsListOfStrings">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.util.tfutil.</span></span><span class="sig-name descname"><span class="pre">TFRecordsFileAsListOfStrings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fileobj</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/tfutil.html#TFRecordsFileAsListOfStrings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.tfutil.TFRecordsFileAsListOfStrings" title="Permalink to this definition">¶</a></dt>
<dd><p>Friends Don’t Let Friends Use TFRecords.</p>
<p>This utility provides a Tensorflow-free, minimal-dependency solution
for reading TFRecords from a <em>file stream</em> (e.g. a buffered reader) and
exposes random access over the stream’s records.</p>
<dl class="simple">
<dt>Based upon:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/tfrecordio.py#L67">https://github.com/apache/beam/blob/master/sdks/python/apache_beam/io/tfrecordio.py#L67</a></p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/versions/r1.11/api_guides/python/python_io#TFRecords_Format_Details">https://www.tensorflow.org/versions/r1.11/api_guides/python/python_io#TFRecords_Format_Details</a></p></li>
<li><p><a class="reference external" href="https://github.com/gdlg/simple-waymo-open-dataset-reader/blob/master/simple_waymo_open_dataset_reader/__init__.py#L19">https://github.com/gdlg/simple-waymo-open-dataset-reader/blob/master/simple_waymo_open_dataset_reader/__init__.py#L19</a></p></li>
<li><p><a class="reference external" href="https://gist.github.com/ed-alertedh/9f49bfc6216585f520c7c7723d20d951">https://gist.github.com/ed-alertedh/9f49bfc6216585f520c7c7723d20d951</a></p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-oarphpy.util.misc">
<span id="oarphpy-util-misc"></span><h1><cite>oarphpy.util.misc</cite><a class="headerlink" href="#module-oarphpy.util.misc" title="Permalink to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.get_size_of_deep">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">get_size_of_deep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#get_size_of_deep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.get_size_of_deep" title="Permalink to this definition">¶</a></dt>
<dd><p>(Hacky) Get size of the value <cite>v</cite> in bytes.  Does not rely on a more
precise library like guppy or pympler.  Intended for values <cite>v</cite> that
contain large binary blobs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.stable_hash">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">stable_hash</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#stable_hash"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.stable_hash" title="Permalink to this definition">¶</a></dt>
<dd><p>A hash of <cite>x</cite> that is stable across program runs.</p>
<p>Background:
As of Python 3, <cite>hash()</cite> is given a fresh seed every time the interpret
starts; hash codes are not stable without setting the env var
<cite>PYTHONHASHSEED</cite>.</p>
<p>Can we just simply adjust for the seed programmatically?
Note that while it is possible to get the hash seed at runtime:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/41088635/extract-hash-seed-in-unit-testing">https://stackoverflow.com/questions/41088635/extract-hash-seed-in-unit-testing</a></p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Python doesn’t use the seed in an easily-inverted way:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://github.com/python/cpython/blob/630c8df5cf126594f8c1c4579c1888ca80a29d59/Python/pyhash.c#L237">https://github.com/python/cpython/blob/630c8df5cf126594f8c1c4579c1888ca80a29d59/Python/pyhash.c#L237</a></p></li>
</ul>
</dd>
</dl>
<p>Thus for stability (and even light portability), we leverage Python
serialization to provide a key for <cite>x</cite>.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.ichunked">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">ichunked</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#ichunked"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.ichunked" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate chunks of <cite>seq</cite> of size (at most) <cite>n</cite>.  More efficient
and less junk than itertools recipes version using izip_longest…</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.roundrobin">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">roundrobin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">seqs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#roundrobin"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.roundrobin" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a sequence pulling round-robin from each of <cite>seqs</cite>; similar to
<cite>itertools.roundrobin()</cite> recipe but</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>won’t hide nested <a href="#id5"><span class="problematic" id="id6">`</span></a>StopIteration`s</p></li>
<li><p>uses a queue to reduce dynamic allocations</p></li>
</ol>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.as_row_of_constants">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">as_row_of_constants</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inst</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#as_row_of_constants"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.as_row_of_constants" title="Permalink to this definition">¶</a></dt>
<dd><p>Row-ify an object instance <cite>inst</cite> keeping only the “class-constant”
attributes of <cite>inst</cite>, i.e. the members with UPPERCASE names.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">CONST</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">__init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">as_row_of_constants</span><span class="p">(</span><span class="n">Foo</span><span class="p">())</span>
<span class="go">OrderedDict([(&#39;CONST&#39;, 5)])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="oarphpy.util.misc.Proxy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">Proxy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#Proxy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.Proxy" title="Permalink to this definition">¶</a></dt>
<dd><p>A thin wrapper around an <cite>instance</cite> that supports custom semantics.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.quiet">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">quiet</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#quiet"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.quiet" title="Permalink to this definition">¶</a></dt>
<dd><p>Silence stdout and stderr for any commands in this context</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.with_cwd">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">with_cwd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#with_cwd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.with_cwd" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a current working directory of <cite>path</cite> for this context</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.to_png_bytes">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">to_png_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#to_png_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.to_png_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Typically used for testing; when comparing images, we need to compare
actual and expected via image bytes b/c imageio does some sort of subtle
color normalization and we want our fixtures to simply be user-readable
PNGs.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.to_jpeg_bytes">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">to_jpeg_bytes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quality</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#to_jpeg_bytes"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.to_jpeg_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a numpy array image <cite>arr</cite>, return the image encoded as a
jpeg buffer.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.get_jpeg_size">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">get_jpeg_size</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jpeg_bytes</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#get_jpeg_size"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.get_jpeg_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the size of a JPEG image without reading and decompressing the entire
file.  Based upon:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/shibukawa/imagesize_py/blob/master/imagesize.py#L87">https://github.com/shibukawa/imagesize_py/blob/master/imagesize.py#L87</a></p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oarphpy.util.misc.download">
<span class="sig-prename descclassname"><span class="pre">oarphpy.util.misc.</span></span><span class="sig-name descname"><span class="pre">download</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dest</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">try_expand</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/oarphpy/util/misc.html#download"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#oarphpy.util.misc.download" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch <cite>uri</cite>, which is a file or archive, and put in <cite>dest</cite>, which
is either a destination file path or destination directory.</p>
</dd></dl>

</section>
<section id="extra">
<h1>Extra<a class="headerlink" href="#extra" title="Permalink to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>
</section>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Maintainers of OarphPy.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>